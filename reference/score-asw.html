<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Score an embedding or a count matrix with the average silhouette width — score-asw • SeuratIntegrate</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Score an embedding or a count matrix with the average silhouette width — score-asw"><meta name="description" content="Compute scores based on the average silhouette width (ASW) metric.
ScoreASW: First, cell-to-cell distances are computed on the provided
embedding or layer matrix. Then, the silhouette score is calculated to
estimate the quality of the partition according to the variable with cell
type labels. Hence, this score measures to what extent cells with identical
label cluster together.
ScoreASWBatch: Similar, but with the batch variable. This score
provides an estimation of batch mixing."><meta property="og:description" content="Compute scores based on the average silhouette width (ASW) metric.
ScoreASW: First, cell-to-cell distances are computed on the provided
embedding or layer matrix. Then, the silhouette score is calculated to
estimate the quality of the partition according to the variable with cell
type labels. Hence, this score measures to what extent cells with identical
label cluster together.
ScoreASWBatch: Similar, but with the batch variable. This score
provides an estimation of batch mixing."><meta property="og:image" content="https://fspecque.github.io/test/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SeuratIntegrate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/SeuratIntegrate.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Integration example: pbmcsca data</a></li>
    <li><a class="dropdown-item" href="../articles/setup_and_tips.html">Advice about conda and future</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Aide-mémoires"><span class="fa fa-sticky-note"></span></button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-"><li><a class="dropdown-item" href="../articles/memo_integration.html">Integration methods</a></li>
    <li><a class="dropdown-item" href="../articles/memo_score.html">Scoring metrics</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cbib/Seurat-Integrate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Score an embedding or a count matrix with the average silhouette width</h1>
      <small class="dont-index">Source: <a href="https://github.com/cbib/Seurat-Integrate/blob/main/R/metrics_silhouette.R" class="external-link"><code>R/metrics_silhouette.R</code></a></small>
      <div class="d-none name"><code>score-asw.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute scores based on the average silhouette width (ASW) metric.</p>
<p><code>ScoreASW</code>: First, cell-to-cell distances are computed on the provided
embedding or layer matrix. Then, the silhouette score is calculated to
estimate the quality of the partition according to the variable with cell
type labels. Hence, this score measures to what extent cells with identical
label cluster together.</p>
<p><code>ScoreASWBatch</code>: Similar, but with the batch variable. This score
provides an estimation of batch mixing.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ScoreASW</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">cell.var</span>,</span>
<span>  <span class="va">what</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"cosine"</span>, <span class="st">"angular"</span>, <span class="st">"manhattan"</span>, <span class="st">"hamming"</span><span class="op">)</span>,</span>
<span>  dist.package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"distances"</span>, <span class="st">"Rfast"</span>, <span class="st">"parallelDist"</span>, <span class="st">"stats"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">AddScoreASW</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">integration</span>,</span>
<span>  <span class="va">cell.var</span>,</span>
<span>  <span class="va">what</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"cosine"</span>, <span class="st">"angular"</span>, <span class="st">"manhattan"</span>, <span class="st">"hamming"</span><span class="op">)</span>,</span>
<span>  dist.package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"distances"</span>, <span class="st">"Rfast"</span>, <span class="st">"parallelDist"</span>, <span class="st">"stats"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ScoreASWBatch</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  batch.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cell.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">what</span>,</span>
<span>  per.cell.var <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"cosine"</span>, <span class="st">"angular"</span>, <span class="st">"manhattan"</span>, <span class="st">"hamming"</span><span class="op">)</span>,</span>
<span>  dist.package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"distances"</span>, <span class="st">"Rfast"</span>, <span class="st">"parallelDist"</span>, <span class="st">"stats"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">AddScoreASWBatch</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">integration</span>,</span>
<span>  batch.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cell.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">what</span>,</span>
<span>  per.cell.var <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"cosine"</span>, <span class="st">"angular"</span>, <span class="st">"manhattan"</span>, <span class="st">"hamming"</span><span class="op">)</span>,</span>
<span>  dist.package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"distances"</span>, <span class="st">"Rfast"</span>, <span class="st">"parallelDist"</span>, <span class="st">"stats"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A Seurat object</p></dd>


<dt id="arg-cell-var">cell.var<a class="anchor" aria-label="anchor" href="#arg-cell-var"></a></dt>
<dd><p>The name of the column with cell type label variable
(must be in the object metadata).
Ignored by <code>ScoreASWBatch</code> when <code>per.cell.var = FALSE</code></p></dd>


<dt id="arg-what">what<a class="anchor" aria-label="anchor" href="#arg-what"></a></dt>
<dd><p>the name of the dimension reduction or layer to score. Must be
in the Seurat object or obtainable after a
<code><a href="https://satijalab.github.io/seurat-object/reference/SplitLayers.html" class="external-link">JoinLayers()</a></code> call.</p></dd>


<dt id="arg-assay">assay<a class="anchor" aria-label="anchor" href="#arg-assay"></a></dt>
<dd><p>name of the assay to use. The output of
<code><a href="https://satijalab.github.io/seurat-object/reference/DefaultAssay.html" class="external-link">DefaultAssay()</a></code> is used by default</p></dd>


<dt id="arg-metric">metric<a class="anchor" aria-label="anchor" href="#arg-metric"></a></dt>
<dd><p>name of the distance metric to use. One of 'euclidean',
'cosine', 'angular', 'manhattan', 'hamming'. See <strong>Note</strong> for details.</p></dd>


<dt id="arg-dist-package">dist.package<a class="anchor" aria-label="anchor" href="#arg-dist-package"></a></dt>
<dd><p>name of the package to compute distances with. One of
'distances', 'Rfast' ,'parallelDist', 'stats'. The latter is always available,
the others must be installed beforehand. They are ordered from fastest to
slowest. When the requested package is not installed, the fastest amongst the
available ones is picked. See <strong>Note</strong> for details.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print messages. Set to <code>FALSE</code> to disable</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional parameters to pass to the distance computation
functions</p></dd>


<dt id="arg-integration">integration<a class="anchor" aria-label="anchor" href="#arg-integration"></a></dt>
<dd><p>name of the integration to score</p></dd>


<dt id="arg-batch-var">batch.var<a class="anchor" aria-label="anchor" href="#arg-batch-var"></a></dt>
<dd><p>The name of the column with batch variable.
(must be in the object metadata). Required by <code>ScoreASWBatch</code>.</p></dd>


<dt id="arg-per-cell-var">per.cell.var<a class="anchor" aria-label="anchor" href="#arg-per-cell-var"></a></dt>
<dd><p>whether to compute silhouette coefficients with the batch
variable for each cell-type separately (default behaviour). Setting to
<code>FALSE</code> causes the silhouette coefficients to be computed on the whole
data directly.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>ScoreASW</code> and <code>ScoreASWBatch</code>: a single float between 0
and 1, corresponding to the scaled average silhouette score.</p>
<p><code>AddScoreASW</code> and <code>AddScoreASWBatch</code>:  the updated Seurat
<code>object</code> with the ASW score(s) set for the integration.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>ScoreASW</code>: Given a matrix (reduction dimension or layer), the
cell-to-cell distance matrix \(D\) is computed. Then, the silhouette width
\(s(i)\) is calculated for each cell \(i\) with a label \(c \in L\)
(\(L\) is the set of possible cell type labels). Then, the mean of all
\(s(i)\) is computed (i.e. the ASW) and scaled between 0 and 1:
$$\displaystyle ASW = \frac{1}{\left| L \right|} \times \sum_{i}{s(i)} \\[10pt]
score = \frac{ASW + 1}{2}$$</p>
<p><code>ScoreAWSBatch</code>: The default parameters (<code>per.cell.var = TRUE</code>)
correspond to the original score from Luecken M.D. <em>et al.</em>, 2022. It is
computed as follow: for each cell type label \(c\) among the set of all
labels \(L\), the cell-to-cell matrix distance \(D_c\) is computed for
cells \(i\) with label \(c\). Each cell's silhouette width \(s(i)\) is
calculated according to the batch variable and transformed to be as close to
1 as its absolute value is close to 0. An average silhouette width
\(ASW_c\) is then computed per cell type label \(c \in L\) and the mean
of those correspond to the final score:
$$\displaystyle ASW_c = \frac{1}{\left| c \right|} \times \sum_{i \in c}{1 - \left| s(i) \right|} \\[10pt]
score = \frac{1}{\left| L \right|} \times \sum_{c \in L}{ASW_c}$$</p>
<p>When <code>per.cell.var = FALSE</code>, \(ASW\) is computed for all cells at once
(just like for <code>ScoreASW</code> but on the batch variable), then scaled
and averaged similarly:
$$\displaystyle score = ASW = \frac{1}{N} \times \sum_{i=1}^{N}{1 - \left| s(i) \right|}$$
with \(N\) being the total number of cells</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Those scores are an adaptation of the (cell-type) ASW and the batch ASW
as described in Luecken M.D. <em>et al.</em>, 2022.</p>
<p>Hamming distance is only supported by the <span class="pkg">parallelDist</span> package, while
<span class="pkg">distances</span> can only compute euclidean and related distances (cosine and
angular). Angular distances are actually refereed to as 'cosine' in
<code><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors()</a></code> (<code>annoy.metric</code>),
hence called 'angular' here. Actual cosine dissimilarity-derived distances
are returned when <code>metric = 'cosine'</code>. Internally, angular distances are
computed with euclidean distances on \(L^2\) norm. cosine distances are
further transformed with :
$$\displaystyle D_{cosine} = \frac{D_{angular}^2}{2}$$</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Luecken, M. D., Büttner, M., Chaichoompu, K., Danese, A.,
Interlandi, M., Mueller, M. F., Strobl, D. C., Zappia, L., Dugas, M.,
Colomé-Tatché, M. &amp; Theis, F. J. Benchmarking atlas-level data integration in
single-cell genomics. Nat Methods 19, 41–50 (2021).
<a href="https://doi.org/10.1038/s41592-021-01336-8" class="external-link">DOI</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></code>, <code><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">silhouette</a></code>
to know more about the silhouette metric, <code><a href="GetNeighborsPerBatch.html">GetNeighborsPerBatch</a></code>
and <code><a href="GetPropInterBatch.html">GetPropInterBatch</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Florian Specque, Domitille Chalopin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

